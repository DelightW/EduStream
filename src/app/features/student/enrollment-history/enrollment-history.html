<div class="section-title" style="margin-top: 40px;">
  <h2>Enrollment History</h2>
  <span class="badge" *ngIf="!(loaderService.isLoading | async)">
    {{ history.length }} Submissions
  </span>
</div>

<div class="history-container">
  <div *ngIf="loaderService.isLoading | async" class="loading-state" style="padding: 40px; text-align: center;">
    <div class="spinner" style="margin-bottom: 10px;">‚è≥</div>
    <p>Processing request...</p>
  </div>

  <table class="history-table" 
         *ngIf="!(loaderService.isLoading | async) && history.length > 0" 
         style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr style="text-align: left; border-bottom: 2px solid #eee;">
        <th>Course</th>
        <th>Email</th>
        <th>Reason</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of history; trackBy: trackById" style="border-bottom: 1px solid #eee;">
        <td>{{ item.courseCode }}</td>
        <td>{{ item.studentEmail }}</td>
        <td>{{ item.reason }}</td>
        <td class="action-group">
          <button class="btn-edit" (click)="editEnrollment(item)" style="padding: 5px 10px; cursor: pointer;">
            ‚úèÔ∏è Edit
          </button>
          <button class="btn-delete" (click)="deleteEnrollment(item.id)" style="padding: 5px 10px; margin-left: 10px; cursor: pointer;">
            üóëÔ∏è Delete
          </button>
           <button class="btn-view" (click)="viewEnrollment(item.id)" style="padding: 5px 10px; margin-left: 10px; cursor: pointer;">
            üîç View
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="!(loaderService.isLoading | async) && history.length === 0" 
       style="text-align: center; padding: 40px; color: #666;">
    <p>No enrollment history found. Enroll in a course to see it here!</p>
  </div>
</div>

<div class="modal-overlay" *ngIf="showEnrollModal" (click)="closeModal()">
  <div class="modal-card" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ editingId ? 'Update Enrollment' : 'New Enrollment' }}</h2>
      <button class="close-btn" (click)="closeModal()">&times;</button>
    </div>

    <form [formGroup]="enrollForm" (ngSubmit)="onEnroll()">
      <div class="form-group">
        <label>Course Name</label>
        <input formControlName="courseCode" placeholder="Enter course name">
      </div>

      <div class="form-group">
        <label>Contact Email</label>
        <input formControlName="studentEmail" type="email" placeholder="Enter email">
      </div>

      <div class="form-group">
        <label>Reason</label>
        <textarea formControlName="reason" placeholder="Why this course?"></textarea>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeModal()" [disabled]="loaderService.isLoading | async">
          Cancel
        </button>
        
        <button type="submit" 
                class="btn-primary" 
                [disabled]="enrollForm.invalid || (loaderService.isLoading | async)">
          <span *ngIf="!(loaderService.isLoading | async)">
            {{ editingId ? 'Save Changes' : 'Submit Request' }}
          </span>
          <span *ngIf="loaderService.isLoading | async">Saving...</span>
        </button>
      </div>
    </form>
  </div>
</div>